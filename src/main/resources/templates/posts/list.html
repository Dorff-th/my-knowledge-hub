<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{${#authorization.expression('isAuthenticated()')} ?
                          'layouts/layout-main' :
                          'layouts/layout-public'}">
<body>
<main layout:fragment="body" class="px-4 sm:px-8 py-8 bg-gray-100 min-h-screen">

    <h2 class="text-2xl font-bold text-gray-800 mb-6">Knowledge Sharing - Posts</h2>

    <div class="mb-4 text-gray-600 text-sm">
        Total Posts:
        <span th:text="${result.totalElements}" class="font-medium text-black">0</span>
    </div>

    <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
    <div class="max-w-5xl mx-auto space-y-4 p-4">
        <div
            th:each="post : ${result.dtoList}"
            th:attr="data-id=${post.id}"
            class="post-card bg-white rounded-lg shadow-md p-4
                   hover:shadow-lg
                   hover:-translate-y-1 hover:scale-[1.01]
                   transform transition duration-300 cursor-pointer"
    >
            <h3
                th:text="${post.title}"
                class="text-base font-semibold text-gray-900 mb-2"
            >
            ê²Œì‹œê¸€ ì œëª©
            </h3>
            <span th:if="${post.commentCount > 0}">
                ğŸ’¬ <span th:text="${post.commentCount}"></span>
            </span>
            <p class="text-sm text-gray-500">
                <span th:text="${post.categoryName}">Category</span>
                <span class="mx-1">Â·</span>
                <span th:text="${#temporals.format(post.createdAt, 'yyyyë…„ MMì›” ddì¼')}">2025ë…„ 07ì›” 26ì¼</span>
                <span class="mx-1">Â·</span>
                <span th:text="${post.nickname}"></span>

            </p>
        </div>

        <!-- ê¸€ì“°ê¸° ë²„íŠ¼ -->

            <div class="flex justify-end mt-7" sec:authorize="isAuthenticated()">
                <a th:href="@{/posts/write}"
                       class="bg-blue-500 text-white px-4 py-2 rounded">
                    âœ Writer
                </a>
            </div>


    </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div th:replace="~{fragments/pagination :: paging(${result}, ${currentPage}, ${''}, ${requestURI})}"></div>
    </div>


</main>

<div layout:fragment="page-script">
        <script type="module" th:inline="javascript">
            import { showLoading, hideLoading } from /*[[@{/js/loading.js}]]*/ '';
            import { showInfoToast } from /*[[@{/js/toast.js}]]*/ '';

                //ì œëª© í´ë¦­ì‹œ ìƒì„¸ë³´ê¸° í˜ì´ì§€ë¡œ ì´ë™
                document.querySelectorAll(".post-card").forEach(card => {
                    card.addEventListener("click", function () {
                        const id = this.dataset.id;
                        window.location.href = `/posts/${id}`;
                    });
                });

                //post ì‚­ì œì‹œ ëª©ë¡ìœ¼ë¡œ redirectí• ë•Œ ì‚­ì œ ì„±ê³µ ë©”ì„¸ì§€ toast íŒì—…
                const params = new URLSearchParams(window.location.search);
                if (params.get("fromDelete") === "true") {
                    showInfoToast("Postê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");

                }
        </script>
    </div>
</body>
</html>
