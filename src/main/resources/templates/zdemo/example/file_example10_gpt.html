<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <title>ë“œë˜ê·¸ì•¤ë“œë¡­ ì—…ë¡œë“œ(drop zone) + ê°œë³„ íŒŒì¼ ì œí•œ(5MB) + ìµœëŒ€ 3ê°œ + ì´í•© 20MB + ì‚­ì œ ë²„íŠ¼(X) (GPT ì œê³µ) </title>
    <style>
        #dropZone {
          border: 2px dashed #888;
          border-radius: 8px;
          padding: 20px;
          text-align: center;
          color: #555;
          cursor: pointer;
          margin-bottom: 10px;
        }
        #dropZone.dragover {
          background-color: #eef;
          border-color: #36f;
          color: #36f;
        }
        #fileList li {
          margin: 5px 0;
        }
    </style>
</head>
<body>

<h3>
    ë“œë˜ê·¸ì•¤ë“œë¡­ ì—…ë¡œë“œ(drop zone) + ê°œë³„ íŒŒì¼ ì œí•œ(5MB) + ìµœëŒ€ 3ê°œ + ì´í•© 20MB + ì‚­ì œ ë²„íŠ¼(X)
</h3>

<div id="dropZone">ì—¬ê¸°ë¡œ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</div>
<input type="file" id="fileInput" multiple hidden>
<ul id="fileList"></ul>
<p id="totalSizeInfo"></p>

<script>
    const dropZone = document.querySelector('#dropZone');
    const input    = document.querySelector('#fileInput');
    const list     = document.querySelector('#fileList');
    const info     = document.querySelector('#totalSizeInfo');

    const MAX_SIZE  = 5 * 1024 * 1024;   // 5MB
    const MAX_FILES = 3;
    const MAX_TOTAL = 20 * 1024 * 1024;  // 20MB

    let dt = new DataTransfer(); // ì „ì—­ì—ì„œ ê´€ë¦¬ (ì¶”ê°€/ì‚­ì œ ëª¨ë‘ ë°˜ì˜)

    function handleFiles(files) {
      let totalSize = [...dt.files].reduce((sum, f) => sum + f.size, 0);

      for (const file of files) {
        if (dt.files.length >= MAX_FILES) {
          alert(`íŒŒì¼ì€ ìµœëŒ€ ${MAX_FILES}ê°œê¹Œì§€ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
          break;
        }
        if (file.size > MAX_SIZE) {
          alert(`${file.name} ì€(ëŠ”) ${(file.size/1024/1024).toFixed(2)} MB â†’ 5MB ì´ˆê³¼ë¡œ ì œì™¸ë¨`);
          continue;
        }
        if (totalSize + file.size > MAX_TOTAL) {
          alert(`ì´ ìš©ëŸ‰ ${(MAX_TOTAL/1024/1024)}MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
          continue;
        }

        dt.items.add(file);
        totalSize += file.size;
      }

      input.files = dt.files;
      renderFileList();
      updateTotalSize(totalSize);
    }

    function renderFileList() {
      list.innerHTML = "";
      for (const file of dt.files) {
        const li = document.createElement('li');
        li.textContent = `${file.name} (${(file.size/1024).toFixed(1)} KB) `;

        const removeBtn = document.createElement('button');
        removeBtn.textContent = "Ã—";
        removeBtn.style.marginLeft = "8px";

        removeBtn.addEventListener('click', () => {
          const newDt = new DataTransfer();
          for (const f of dt.files) {
            if (f.name !== file.name) {
              newDt.items.add(f);
            }
          }
          dt = newDt;
          input.files = dt.files;
          renderFileList();
          updateTotalSize([...dt.files].reduce((sum, f) => sum + f.size, 0));
        });

        li.appendChild(removeBtn);
        list.appendChild(li);
      }
    }

    function updateTotalSize(size) {
      info.textContent = `ì´ ì—…ë¡œë“œ ìš©ëŸ‰: ${(size/1024/1024).toFixed(2)} MB`;
    }

    // ğŸ“Œ ë“œë˜ê·¸ì•¤ë“œë¡­ ì´ë²¤íŠ¸
    dropZone.addEventListener('click', () => input.click());

    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('dragover');
    });
    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('dragover');
    });
    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('dragover');
      handleFiles(e.dataTransfer.files);
    });

    // ğŸ“Œ ì¼ë°˜ íŒŒì¼ ì„ íƒ
    input.addEventListener('change', () => {
      handleFiles(input.files);
    });

</script>
</body>
</html>